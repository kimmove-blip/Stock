# 자동매매 전략 버전 비교 문서

## 버전 히스토리

| 버전 | 함수명 | 운영 기간 | 핵심 철학 |
|------|--------|-----------|-----------|
| V1 | `calculate_score_v1()` | ~2026.01.20 | 모든 지표 종합 (역발상 포함) |
| V2 | `calculate_score_v2()` | 2026.01.21~ | 추세 추종 (떨어지는 칼날 회피) |
| V4 | `calculate_score_v4()` | 장중 스코어 | Hybrid Sniper (정밀 진입) |
| V5 | `calculate_score_v5()` | 장중 스코어 | 장대양봉 (에너지 응축→발산) |

---

## V1: 종합 기술적 분석 (analyze_full)

### 핵심 철학
- **모든 지표를 종합**하여 점수 산출
- **과매도 = 매수 기회** (역발상 투자)
- 역배열도 감점일 뿐, 과락 없음

### 점수 체계

#### 1. 이동평균선 (MA)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| SMA 5 > SMA 20 > SMA 60 (정배열) | +15 | MA_ALIGNED |
| SMA 5가 SMA 20 상향돌파 | +20 | GOLDEN_CROSS_5_20 |
| SMA 20이 SMA 60 상향돌파 | +25 | GOLDEN_CROSS_20_60 |
| SMA 5가 SMA 20 하향돌파 | -15 | DEAD_CROSS_5_20 |
| SMA 5 < SMA 20 < SMA 60 (역배열) | -10 | MA_REVERSE_ALIGNED |

#### 2. RSI (14일)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| RSI < 30 (과매도) | **+15** | RSI_OVERSOLD |
| 30 ≤ RSI < 50 | +5 | RSI_RECOVERING |
| RSI > 70 (과매수) | -10 | RSI_OVERBOUGHT |

#### 3. MACD (12, 26, 9)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| MACD 선이 Signal 상향돌파 | +20 | MACD_GOLDEN_CROSS |
| 히스토그램: 음수→양수 전환 | +10 | MACD_HIST_POSITIVE |
| 히스토그램: 음수 구간에서 상승 중 | +5 | MACD_HIST_RISING |

#### 4. Stochastic (K:14, D:3)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| K < 30 에서 K가 D 상향돌파 | +20 | STOCH_GOLDEN_OVERSOLD |
| K가 D 상향돌파 (일반) | +10 | STOCH_GOLDEN_CROSS |
| K < 20 (과매도) | +5 | STOCH_OVERSOLD |

#### 5. 볼린저밴드 (20일, 2σ)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 하단밴드 터치 후 반등 | +15 | BB_LOWER_BOUNCE |
| 하단밴드 터치 | +10 | BB_LOWER_TOUCH |
| 상단밴드 돌파 | -5 | BB_UPPER_BREAK |

#### 6. ADX (14일)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| ADX > 25 + DI+ > DI- | +15 | ADX_STRONG_UPTREND |
| ADX > 20 + DI+ > DI- | +10 | ADX_UPTREND |

#### 7. CCI (20일)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| CCI < -100 (과매도) | +10 | CCI_OVERSOLD |
| CCI > 100 (과매수) | -5 | CCI_OVERBOUGHT |

#### 8. Williams %R
| 조건 | 점수 | 신호명 |
|------|------|--------|
| %R < -80 (과매도) | +10 | WILLR_OVERSOLD |
| %R > -20 (과매수) | -5 | WILLR_OVERBOUGHT |

#### 9. OBV (거래량 누적)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| OBV > OBV의 20일 이평선 | +10 | OBV_ABOVE_MA |
| OBV가 5일 전보다 5% 이상 상승 | +5 | OBV_RISING |

#### 10. MFI (14일)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| MFI < 20 (과매도) | +15 | MFI_OVERSOLD |
| 20 ≤ MFI < 40 | +5 | MFI_LOW |
| MFI > 80 (과매수) | -10 | MFI_OVERBOUGHT |

#### 11. 거래량
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 20일 평균 대비 ≥ 2.0배 | +15 | VOLUME_SURGE |
| 20일 평균 대비 ≥ 1.5배 | +10 | VOLUME_HIGH |
| 20일 평균 대비 ≥ 1.2배 | +5 | VOLUME_ABOVE_AVG |

#### 12. Supertrend
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 하락→상승 추세 전환 | +20 | SUPERTREND_BUY |
| 상승 추세 유지 중 | +5 | SUPERTREND_UPTREND |

#### 13. PSAR
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 매수 신호 발생 | +15 | PSAR_BUY_SIGNAL |

#### 14. ROC (Rate of Change)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 0선 상향돌파 | +10 | ROC_POSITIVE_CROSS |
| ROC > 5% | +5 | ROC_STRONG_MOMENTUM |

#### 15. 일목균형표
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 전환선이 기준선 상향돌파 | +15 | ICHIMOKU_GOLDEN_CROSS |
| 가격 > 구름대 | +10 | ICHIMOKU_ABOVE_CLOUD |

#### 16. CMF (Chaikin Money Flow)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| CMF > 0.2 (강한 자금 유입) | +10 | CMF_STRONG_INFLOW |
| CMF > 0 | +5 | CMF_POSITIVE |
| CMF < -0.2 (강한 자금 유출) | -10 | CMF_STRONG_OUTFLOW |

#### 17. 52주 고/저가
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 현재가 ≥ 52주 고가의 98% | +15 | NEW_HIGH_52W |
| 52주 고가 돌파 | +5 추가 | BREAKOUT_52W_HIGH |
| 현재가 ≤ 52주 저가의 102% | -10 | NEW_LOW_52W |

#### 18. 캔들 패턴
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 샛별형 (Morning Star) | +20 | MORNING_STAR |
| 상승장악형 (Bullish Engulfing) | +15 | BULLISH_ENGULFING |
| 망치형 (Hammer) | +10 | HAMMER |
| 역망치형 (Inverted Hammer) | +8 | INVERTED_HAMMER |
| 저녁별형 (Evening Star) | -15 | EVENING_STAR |
| 하락장악형 (Bearish Engulfing) | -10 | BEARISH_ENGULFING |

### 점수 스케일링 (V1)

```python
if raw_score <= 60:
    scaled = raw_score * 0.9           # 0-60 → 0-54
elif raw_score <= 100:
    scaled = 54 + (raw_score - 60) * 0.65  # 60-100 → 54-80
else:
    scaled = 80 + (raw_score - 100) * 0.4  # 100+ → 80-100
```

| 원점수 | 최종 점수 |
|--------|-----------|
| 40 | 36 |
| 60 | 54 |
| 80 | 67 |
| 100 | 80 |
| 120 | 88 |
| 150 | 100 |

### 매매 기준 (V1)

| 점수 | 의미 | 동작 |
|------|------|------|
| 90-100 | 극강 매수 | 우선 매수 |
| 80-89 | 강한 매수 | 즉시 매수 |
| 70-79 | 중간 매수 | 기본 매수 기준 |
| 50-69 | 중립 | 관망 |
| ≤ 50 | 매도 기준 | 자동 매도 |

---

## V2: 추세 추종 강화판 (analyze_trend_following_strict)

### 핵심 철학
- **추세를 따라가는 것**이 핵심 (Trend Following)
- **과매도 = 떨어지는 칼날** (잡지 않음)
- **역배열 = 과락** (점수 0, 매수 금지)
- 20일선 기울기와 거래대금으로 **진짜 주도주** 필터링

### V1 → V2 변경점

| 항목 | V1 | V2 |
|------|----|----|
| RSI < 30 | +15점 (매수 기회) | **과락 요소** (떨어지는 칼날) |
| RSI 70~85 | -10점 (과매수) | **0점** (강세 유지) |
| 역배열 | -10점 (감점) | **0점 반환** (과락) |
| CCI, Williams %R | 사용 | **제거** (중복 지표) |
| 20일선 기울기 | 없음 | **핵심 지표** (+15점) |
| 거래대금 필터 | 없음 | **500억 이상** (+15점) |
| 60일 신고가 | 없음 | **돌파 시** (+15점) |
| 매수 기준 | 70점 | **75점** |

### 점수 그룹 (V2)

#### 추세 그룹 (최대 30점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 정배열 | +5 | MA_ALIGNED |
| 20일선 기울기 ≥ 3% | +15 | MA_20_VERY_STEEP |
| 20일선 기울기 ≥ 1.5% | +10 | MA_20_STEEP |
| 20일선 기울기 ≥ 0.5% | +3 | MA_20_RISING |
| MACD > 0 | +3 | MACD_BULL |
| Supertrend 매수 전환 | +7 | SUPERTREND_BUY |

#### 모멘텀 그룹 (최대 35점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| RSI 60~75 (Sweet Spot) | +15 | RSI_SWEET_SPOT |
| RSI 50~60 | +5 | RSI_HEALTHY |
| RSI > 80 (계속 상승 중) | +10 | RSI_POWER_BULL |
| RSI > 80 (꺾임) | -5 | RSI_PEAK_OUT |
| RSI < 30 | -10 | RSI_FALLING_KNIFE |
| 60일 신고가 돌파 | +15 | BREAKOUT_60D_HIGH |
| 60일 고가 97% 이내 | +7 | NEAR_60D_HIGH |

#### 수급 그룹 (최대 35점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 거래량 ≥ 5배 | +20 | VOLUME_EXPLOSION |
| 거래량 ≥ 3배 | +12 | VOLUME_SURGE_3X |
| 거래량 ≥ 2배 | +5 | VOLUME_HIGH |
| 거래대금 ≥ 500억 | +15 | TRADING_VALUE_500B |
| 거래대금 ≥ 100억 | +10 | TRADING_VALUE_100B |
| 거래대금 ≥ 30억 | +3 | TRADING_VALUE_30B |
| 거래대금 < 10억 | -5 | LOW_LIQUIDITY |

### 점수 스케일링 (V2)
- **스케일링 없음** (원점수 그대로 사용)
- 80점 넘으려면: 기울기 + 신고가 + 거래대금 모두 충족 필요

### 매매 기준 (V2)

| 점수 | 동작 |
|------|------|
| ≥ 75 | 매수 |
| ≤ 40 | 매도 (점수 기반) |
| 20일선 이탈 | 매도 (래치 전략) |
| -6% | 손절 |

---

## 핵심 비교 요약

```
┌─────────────────────────────────────────────────────────────────────┐
│                        V1 vs V2 핵심 차이                           │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  V1 (역발상 포함)              V2 (순수 추세 추종)                  │
│  ─────────────────             ──────────────────                   │
│  "싸면 사자"                   "오르는 놈 더 오른다"                │
│  과매도 = 기회 (+15)           과매도 = 위험 (-10)                  │
│  역배열 = 감점 (-10)           역배열 = 과락 (0점)                  │
│  17개 지표 종합                 3그룹 핵심 지표                     │
│  70점 매수                     75점 매수                            │
│  점수 스케일링 O               스케일링 X (빡빡)                    │
│                                                                     │
│  장점: 저점 매수 가능          장점: 주도주 포착                    │
│  단점: 떨어지는 칼날 위험      단점: 초기 진입 어려움               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 같은 종목에 대한 점수 차이 예시

| 상황 | V1 점수 | V2 점수 | 설명 |
|------|---------|---------|------|
| 급락 후 과매도 | 60점 | 0점 | V1은 반등 기대, V2는 매수 금지 |
| 정배열 + 횡보 | 45점 | 30점 | V2는 기울기 없으면 낮은 점수 |
| 역배열 상태 | 35점 | 0점 | V2는 과락 |
| 신고가 돌파 + 거래량 폭발 | 75점 | 85점 | V2가 더 높이 평가 |

---

## 파일 위치

| 버전 | 파일 | 함수 |
|------|------|------|
| V1 | `technical_analyst.py` | `analyze_full()` |
| V2 | `technical_analyst.py` | `analyze_trend_following_strict()` |

---

## 버전 선택 가이드

### V1 사용 권장
- 저점 매수 전략
- 역발상 투자 스타일
- 장기 보유 목적

### V2 사용 권장
- 추세 추종 전략
- 단기~중기 매매
- 주도주 발굴 목적
- 손실 최소화 우선

---

---

## V4: Hybrid Sniper (하이브리드 스나이퍼)

### 핵심 철학
- **고급 기술적 분석**으로 정밀 진입
- **VCP 패턴**, **OBV 다이버전스** 등 세력 축적 신호 탐지
- **기관/외국인 수급** 데이터 활용 (한투 API)
- 85점 이상 = 강력 매수

### 점수 그룹 (V4)

#### 추세 그룹 (최대 30점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 정배열 | +5 | MA_ALIGNED |
| 20일선 기울기 ≥ 3% | +15 | MA_20_VERY_STEEP |
| 20일선 기울기 ≥ 1.5% | +10 | MA_20_STEEP |
| 20일선 기울기 ≥ 0.5% | +5 | MA_20_RISING |
| 일목 구름대 위 | +5 | ABOVE_CLOUD |
| MACD > 0 & 상승 | +5 | MACD_BULL |
| MACD 하락 다이버전스 | -5 | MACD_BEAR_DIV |

#### 수급 그룹 (최대 30점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| 거래량 ≥ 5배 | +12 | VOLUME_EXPLOSION |
| 거래량 ≥ 3배 | +8 | VOLUME_SURGE_3X |
| 거래량 ≥ 2배 | +4 | VOLUME_HIGH |
| 거래대금 ≥ 500억 | +10 | TRADING_VALUE_500B |
| 거래대금 ≥ 100억 | +6 | TRADING_VALUE_100B |
| 거래대금 ≥ 30억 | +3 | TRADING_VALUE_30B |
| 거래대금 < 10억 | -5 | LOW_LIQUIDITY |
| 기관+외국인 5일 순매수 > 0 | +5 | INST_FOREIGN_BUY |
| 외국인 3일 연속 순매수 | +3 | FOREIGN_CONSEC_BUY |
| 기관+외국인 5일 순매도 | -3 | INST_FOREIGN_SELL |

#### 패턴 그룹 (최대 20점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| VCP 패턴 감지 | +12 | VCP_PATTERN |
| OBV 불리시 다이버전스 | +8 | OBV_BULL_DIV |

#### 모멘텀 그룹 (최대 20점)
| 조건 | 점수 | 신호명 |
|------|------|--------|
| RSI 60~75 | +8 | RSI_SWEET_SPOT |
| RSI 50~60 | +4 | RSI_HEALTHY |
| RSI > 85 | -5 | RSI_EXTREME |
| StochRSI 골든크로스 (K<30) | +7 | STOCHRSI_GOLDEN |
| StochRSI 상승 추세 | +4 | STOCHRSI_RISING |
| 60일 신고가 돌파 | +5 | BREAKOUT_60D_HIGH |
| 유성형 캔들 | -5 | SHOOTING_STAR |

### V4 특수 기능

#### VCP (Volatility Contraction Pattern)
```
VCP 특징:
1. 고점은 비슷하게 유지
2. 저점은 점점 높아짐 (수축)
3. 거래량도 수축
4. 마지막에 거래량 터지며 돌파
```

#### OBV 다이버전스
```
불리시 다이버전스:
- 가격: 신저가 갱신 또는 하락
- OBV: 상승 (매집 중)
→ 세력이 물량 모으는 중, 상승 전조
```

---

## V5: 장대양봉 (Long Bullish Candle)

### 핵심 철학
- **"거래량은 주가의 선행 지표"** - 세력의 매집과 이탈을 거래량으로 추적
- **"에너지의 응축 후 발산"** - 횡보/수축 구간 후 폭발적 상승 패턴 포착
- 6가지 스크리닝 기법으로 장대양봉 가능성 분석

### 스크리닝 기법 (6가지)

1. **거래량 급감 눌림목** - N자형 상승 패턴
2. **볼린저 밴드 수축** - 돌파 준비 상태
3. **이동평균선 밀집 정배열** - 5/10/20/60 수렴
4. **OBV 다이버전스** - 매집 신호
5. **RSI/MACD/스토캐스틱** - 복합 모멘텀
6. **매물대 분석** - 저항선 돌파 가능성

### 점수 그룹 (V5)

#### 눌림목 패턴 (최대 30점)
| 조건 | 점수 | 설명 |
|------|------|------|
| 거래량 급감 눌림목 | 최대 +30 | N자형 상승 후 조정 |
| 패턴 확인됨 | +15~30 | 거래량 수축 정도에 따라 |

#### 볼린저 밴드 (최대 25점)
| 조건 | 점수 | 설명 |
|------|------|------|
| BB 수축 (squeeze) | +15 | 밴드폭 축소 |
| 돌파 준비 상태 | +25 | 수축 + 상단 접근 |

#### 이동평균선 (최대 25점)
| 조건 | 점수 | 설명 |
|------|------|------|
| MA 밀집 | +15 | 5/10/20/60 수렴 |
| 밀집 + 정배열 | +25 | 수렴 후 정배열 형성 |

#### OBV 다이버전스 (최대 20점)
| 조건 | 점수 | 설명 |
|------|------|------|
| 가격↓ OBV↑ | +20 | 불리시 다이버전스 (매집) |
| 가격↑ OBV↓ | -10 | 베어리시 다이버전스 (분배) |

#### 모멘텀 (보조)
| 조건 | 설명 |
|------|------|
| RSI | 과매도 탈출, 상승 전환 |
| MACD | 골든크로스, 히스토그램 양전환 |
| Stochastic | 과매도 골든크로스 |

#### 매물대 (보조)
| 조건 | 설명 |
|------|------|
| 저항선 분석 | 돌파 가능성 평가 |
| 지지선 확인 | 바닥 지지 여부 |

---

## 엔진별 핵심 차이 요약

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      V1 / V2 / V4 / V5 핵심 비교                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   항목          │ V1        │ V2        │ V4           │ V5               │
│  ───────────────┼───────────┼───────────┼──────────────┼─────────────────  │
│   철학          │ 역발상    │ 추세추종  │ 정밀진입     │ 에너지축적       │
│   RSI<30        │ +15 매수  │ -10 감점  │ -           │ -               │
│   역배열        │ -10 감점  │ 0점 과락  │ -           │ -               │
│   VCP 패턴      │ ✗         │ ✗         │ +12         │ ✗               │
│   OBV 다이버    │ ✗         │ ✗         │ +8          │ +20              │
│   기관/외국인   │ ✗         │ ✗         │ +8          │ ✗               │
│   BB 수축       │ ✗         │ ✗         │ ✗           │ +25              │
│   MA 밀집       │ ✗         │ ✗         │ ✗           │ +25              │
│   일목균형표    │ ✓         │ ✗         │ +5          │ ✗               │
│   StochRSI      │ ✗         │ ✗         │ +7          │ ✗               │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 상황별 추천 엔진

| 상황 | 추천 엔진 | 이유 |
|------|----------|------|
| 급락 후 반등 | V1 | 과매도 가점 |
| 추세 상승 중 | V2 | 20일선 기울기 + 신고가 |
| 세력 매집 | V4 | VCP + OBV 다이버전스 |
| 횡보 후 돌파 | V5 | BB 수축 + MA 밀집 |
| 외국인 매수세 | V4 | 기관/외국인 수급 |

---

## 파일 위치

| 버전 | 파일 | 함수 |
|------|------|------|
| V1 | `scoring/scoring_v1.py` | `calculate_score_v1()` |
| V2 | `scoring/scoring_v2.py` | `calculate_score_v2()` |
| V4 | `scoring/scoring_v4.py` | `calculate_score_v4()`, `calculate_score_v4_with_investor()` |
| V5 | `scoring/scoring_v5.py` | `calculate_score_v5()` |

---

*문서 작성일: 2026-01-21*
*V4/V5 추가: 2026-02-02*
*작성자: Claude Code*
