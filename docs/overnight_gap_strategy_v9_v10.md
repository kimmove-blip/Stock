# 오버나잇 갭 전략 백테스트 결과 (V9~V10)

> 작성일: 2026-01-26
> 테스트 기간: 2025-01-23 ~ 2026-01-23 (1년)

## 개요

익일 시가 갭 상승을 예측하는 다양한 전략을 백테스트하여 최적의 조건을 탐색했습니다.

### 거래 비용
- 매수 수수료: 0% (증권사 이벤트)
- 매도 수수료 + 세금: **0.203%**
- 모든 수익률은 비용 차감 후 실제 수익률 기준

---

## 1. V9: 확률 기반 분류 모델

### 방법론
- RandomForest 분류 모델로 갭 상승 확률 예측
- 피처: 캔들 패턴, 거래량 비율, 이동평균, 기술적 지표 등
- 학습 데이터: 62,719개, 테스트 데이터: 26,881개

### 결과: 확률 임계값별 성과 (비용 0.203% 차감 후)

| 확률 임계값 | 거래수 | 승률 | 평균수익률(gross) | 실제수익률(net) | 연간 총수익 |
|-------------|--------|------|-------------------|-----------------|-------------|
| ≥50% | 18,245 | 55.9% | 0.128% | -0.075% | -1,368% |
| ≥60% | 5,927 | 59.2% | 0.269% | +0.066% | +391% |
| **≥70%** | **909** | **61.2%** | **0.388%** | **+0.185%** | **+168%** |
| ≥75% | 312 | 63.8% | 0.631% | +0.428% | +134% |
| ≥80% | 98 | 61.2% | 0.649% | +0.446% | +44% |
| ≥85% | 30 | 50.0% | 0.202% | -0.001% | 0% |

### 결론
- **확률 70% 이상 조건이 최적** (승률 61.2%, 실제수익률 +0.185%, 연간 +168%)
- 하루 평균 3~4건 거래로 실용적
- 50% 이하는 비용 차감 시 손실
- 확률 85% 이상은 샘플 부족으로 성과 불안정

---

## 2. V10: 갭업 + B필터 전략

### B필터 조건
1. 거래대금 50억 이상
2. 당일 등락률 0~10%
3. 거래량 20일 평균 대비 2배 이상
4. 종가 > MA5 > MA20

### 결과: 갭 조건별 성과

| 조건 | 거래수 | 승률 | 평균수익률 |
|------|--------|------|------------|
| B필터만 | 2,123 | 51.2% | -0.073% |
| +1% 갭 이상 + B필터 | 263 | 60.1% | +0.88% |
| **+2% 갭 이상 + B필터** | **76** | **68.4%** | **+1.41%** |
| +3% 갭 이상 + B필터 | 24 | 70.8% | +1.67% |

### 결론
- B필터만으로는 효과 미미
- **2%+ 갭 조건 추가 시 승률 68.4%, 수익률 +1.41%**
- 단, 연간 76건으로 거래 빈도 낮음

---

## 3. V10 + 확률 80% 조건 (결합 테스트)

### 방법론
V9의 확률 모델 + V10의 B필터 결합

### 결과

| 조건 | 거래수 | 승률 | 평균수익률 |
|------|--------|------|------------|
| ≥50% + B필터 | 10,756 | 56.2% | 0.145% |
| ≥60% + B필터 | 3,391 | 59.9% | 0.303% |
| ≥70% + B필터 | 509 | 63.1% | 0.452% |
| ≥75% + B필터 | 184 | 65.2% | 0.782% |
| **≥80% + B필터** | **54** | **66.7%** | **0.883%** |

### 결론
- B필터 추가 시 모든 확률 레벨에서 성과 개선
- 80% 확률 + B필터: 승률 66.7%, 수익률 +0.88%
- 거래 빈도가 너무 낮아짐 (연간 54건)

---

## 4. 옵션 C: 시장 상황 필터

### 방법론
KOSPI 지수 추세에 따라 매매 여부 결정

### 결과

| 조건 | 거래수 | 승률 | 평균수익률 |
|------|--------|------|------------|
| V10 전체 (기준) | 2,123 | 51.2% | -0.073% |
| 상승장 (bullish) | 1,809 | 51.8% | -0.032% |
| 하락장 (bearish) | 314 | 47.8% | -0.311% |
| 강한 상승장 | 1,617 | 52.5% | -0.066% |
| 상승장 + 거래량3배 | 1,087 | 50.2% | -0.312% |

### 결론
- **시장 필터는 유의미한 효과 없음**
- 하락장에서만 손실이 약간 더 큼
- 추가 필터로 사용 가치 낮음

---

## 5. 옵션 D: 다일 보유 전략

### 방법론
익일 시가 매수 후 N일 보유 성과 비교

### 결과: 보유 기간별 성과

| 보유기간 | 승률 | 중앙값 수익률 |
|----------|------|---------------|
| 갭만 (당일) | 50.6% | -0.044% |
| 1일 보유 | 41.2% | -1.034% |
| 2일 보유 | 43.0% | -1.082% |
| 3일 보유 | 43.2% | -1.252% |
| 5일 보유 | 45.4% | -1.054% |

### 결과: 손절/익절 전략 (2일 보유)

| 손절 | 익절 | 승률 | 평균수익률 |
|------|------|------|------------|
| -3% | 10% | 40.8% | **+0.821%** |
| -3% | 7% | 41.0% | +0.485% |
| -3% | 5% | 41.6% | +0.153% |
| -5% | 10% | 42.2% | +0.236% |

### 결론
- **단순 보유는 갭 전략보다 성과 나쁨**
- 손절/익절 적용 시 수익 개선 가능 (-3% 손절 + 10% 익절)
- 그러나 복잡도 대비 효과 제한적

---

## 최종 결론: 전략 비교 (비용 0.203% 차감 후)

| 전략 | 거래수 | 승률 | 실제수익률 | 연간 총수익 | 실용성 |
|------|--------|------|------------|-------------|--------|
| **V9 확률 ≥70%** | **909** | **61.2%** | **+0.185%** | **+168%** | **최고** |
| V9 확률 ≥75% | 312 | 63.8% | +0.428% | +134% | 좋음 |
| V10 (2%+갭+B) | 76 | 68.4% | +1.21% | +92% | 낮음 |
| V10 확률80%+B | 54 | 66.7% | +0.68% | +37% | 낮음 |
| 시장 필터 | - | - | - | - | 효과없음 |
| 다일 보유 | - | ~43% | - | - | 효과없음 |

---

## 최종 권장 전략: V9 확률 70% 이상

### 조건
1. RandomForest 모델로 갭 상승 확률 계산
2. **확률 70% 이상인 종목만 매매**
3. 거래대금 50억 이상 필터

### 기대 성과 (비용 차감 후)
- **승률: 61.2%**
- **실제 수익률: +0.185%/건** (비용 0.203% 차감 후)
- **연간 거래 수: 약 900건** (하루 3~4건)
- **연간 기대 총수익: +168%** (복리 미적용)

### 거래 비용
- 매수: 0% (증권사 무료 이벤트)
- 매도: 0.203% (수수료 + 세금)

### 장점
1. 충분한 거래 빈도로 실전 활용 가능
2. 60% 이상 안정적인 승률
3. 단순한 진입/청산 규칙
4. 비용 차감 후에도 유의미한 수익

### 매매 규칙
- **진입**: 장 마감 전 매수 (전일)
- **청산**: 익일 시가에 매도
- **리스크 관리**: 종목당 투자금 제한 (예: 총자산의 5%)

---

## 관련 파일

| 파일 | 설명 |
|------|------|
| `backtest_v10_prob80.py` | V10 + 확률 80% 백테스트 |
| `backtest_v10_market_filter.py` | 시장 상황 필터 백테스트 |
| `backtest_v10_multiday.py` | 다일 보유 전략 백테스트 |
| `output/v10_prob80_backtest.xlsx` | 확률 80% 결과 |
| `output/v10_market_filter_backtest.xlsx` | 시장 필터 결과 |
| `output/v10_multiday_backtest.xlsx` | 다일 보유 결과 |
