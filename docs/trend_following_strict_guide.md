# 변별력 강화판 추세 추종 로직 가이드

> 작성일: 2026-01-20

## 1. 개요

기존 추세 추종 로직의 **변별력 부족 문제**를 해결하기 위해 새롭게 설계한 로직입니다.

### 기존 로직 문제점
- 정배열, MACD > 0 등 "당연한" 신호에 높은 점수 부여
- 거의 모든 종목이 80점 이상 → 변별력 없음
- 거래량 기준이 너무 낮음 (2배)
- 거래대금 미고려 → 소형 잡주도 고득점

### 변별력 강화 핵심
- **점수 다이어트**: 정배열 +15 → +5, MACD +10 → +3
- **20일선 기울기**: 급등 추세에 가산점
- **거래대금 필터**: 100억 이상 가산점, 10억 미만 감점
- **60일 신고가**: 매물대 없는 종목 우대
- **거래량 기준 상향**: 2배 → 3배

---

## 2. 점수 체계

### 2.1 추세 그룹 (최대 30점)

| 조건 | 점수 | 신호 |
|------|------|------|
| 정배열 (5>20>60) | +5 | MA_ALIGNED |
| 20일선 기울기 3%+ | +15 | MA_20_VERY_STEEP |
| 20일선 기울기 1.5%+ | +10 | MA_20_STEEP |
| 20일선 기울기 0.5%+ | +3 | MA_20_RISING |
| MACD > 0 | +3 | MACD_BULL |
| Supertrend 매수전환 | +7 | SUPERTREND_BUY |

**과락 조건**: 역배열(5<20<60) → 0점 즉시 반환

### 2.2 모멘텀 그룹 (최대 35점)

| 조건 | 점수 | 신호 |
|------|------|------|
| RSI 60~75 (Sweet Spot) | +15 | RSI_SWEET_SPOT |
| RSI 50~60 | +5 | RSI_HEALTHY |
| RSI 80+ 상승중 | +10 | RSI_POWER_BULL |
| RSI 80+ 꺾임 | -5 | RSI_PEAK_OUT |
| RSI < 30 | -10 | RSI_FALLING_KNIFE |
| 60일 신고가 돌파 | +15 | BREAKOUT_60D_HIGH |
| 60일 고점 97% 이상 | +7 | NEAR_60D_HIGH |
| 60일 고점 95% 이상 | +3 | CLOSE_TO_60D_HIGH |

### 2.3 거래량/거래대금 그룹 (최대 35점)

| 조건 | 점수 | 신호 |
|------|------|------|
| 거래량 5배+ | +20 | VOLUME_EXPLOSION |
| 거래량 3배+ | +12 | VOLUME_SURGE_3X |
| 거래량 2배+ | +5 | VOLUME_HIGH |
| 거래대금 500억+ | +15 | TRADING_VALUE_500B |
| 거래대금 100억+ | +10 | TRADING_VALUE_100B |
| 거래대금 30억+ | +3 | TRADING_VALUE_30B |
| 거래대금 10억 미만 | -5 | LOW_LIQUIDITY |

---

## 3. 매매 전략

### 3.1 기본 전략 (점수 기반)

| 상황 | 점수 | 액션 |
|------|------|------|
| **매수** | 80점 이상 | 강력 진입 |
| **보유** | 60~79점 | 추세 유지 중 |
| **매도** | 60점 미만 | 모멘텀 소멸 |
| **손절** | 20일선 이탈 | 무조건 탈출 |

### 3.2 래치 전략 (권장)

> "진입은 점수로, 청산은 가격으로"

점수는 변동성이 크기 때문에, 매수 후에는 점수를 보지 않고 **오직 20일선**만 봅니다.

```python
def make_trading_decision_stable(current_score, current_price, sma20, has_position):
    # 매수: 점수 80점 이상
    if not has_position:
        if current_score >= 80:
            return "BUY"
        return "WAIT"

    # 매도: 점수 무시, 20일선 이탈 시에만
    else:
        if current_price < sma20:
            return "SELL (추세 이탈)"
        if current_score < 40:  # 극단적 하락만
            return "SELL (모멘텀 완전 소멸)"
        return "HOLD"
```

### 3.3 휩소 방지 전략

1. **3일 유예 룰**: 점수가 3일 연속 60점 미만일 때만 매도
2. **확정봉 기준**: 장중 점수 무시, 종가 기준으로만 판단

---

## 4. 백테스트 결과

### 4.1 테스트 조건
- 기간: 2025-12-05 ~ 2026-01-20 (약 30거래일)
- 초기자본: 1,000만원
- 최대 포지션: 5종목

### 4.2 전략 비교

| 지표 | 점수 기반 전략 | 래치 전략 |
|------|--------------|----------|
| **매수 조건** | 80점 이상 | 80점 이상 |
| **매도 조건** | 60점 미만 | 20일선 이탈 또는 40점 미만 |
| **총 수익률** | +20.98% | **+82.99%** |
| **승률** | 42.1% | **61.1%** |
| **손익비** | 2.82:1 | **7.51:1** |
| **평균 이익** | +28.69% | **+50.19%** |
| **평균 손실** | -10.16% | **-6.68%** |
| **평균 보유일** | - | 9.2일 |
| **거래 수** | 19건 | 18건 |

### 4.3 래치 전략 상세 결과

#### 대박 종목 (수익률 50% 이상)
| 종목 | 매수일 | 매도일 | 수익률 | 보유일 |
|------|--------|--------|--------|--------|
| 모베이스전자 | 01-08 | 01-20 | **+192.28%** | 12일 |
| 뉴로메카 | 01-13 | 01-20 | **+115.46%** | 7일 |
| 현대약품 | 12-05 | 12-29 | **+75.10%** | 24일 |
| 세아베스틸지주 | 12-12 | 01-14 | **+51.73%** | 33일 |

#### 청산 사유 분석
| 청산 사유 | 건수 | 승률 | 평균 수익률 |
|----------|------|------|------------|
| 극단적 점수 하락 (40점 미만) | 13건 | 69.2% | **+38.51%** |
| 테스트 종료 | 5건 | 40.0% | +0.92% |

> **핵심 인사이트**: 20일선 이탈 전에 점수가 먼저 40점 미만으로 붕괴하는 경우가 대부분.
> 즉, 극단적 점수 하락이 추세 이탈의 선행 지표 역할을 함.

### 4.4 점수 구간별 (5일 보유 기준)

| 점수 | 거래수 | 평균 수익률 | 승률 |
|------|--------|------------|------|
| 80점 이상 | 16건 | **+16.49%** | 43.8% |
| 70점 이상 | 92건 | +5.86% | 42.4% |
| 60점 이상 | 200건 | +5.36% | 48.0% |

### 4.5 래치 전략 우위 분석

**왜 래치 전략이 4배 높은 수익률을 기록했나?**

1. **휩소 방지**: 점수 60점 매도 전략은 일시적 점수 하락에 흔들려 조기 청산
2. **대박 종목 홀딩**: 래치 전략은 추세가 살아있는 한 계속 보유 → 192%, 115% 수익 실현
3. **손실 제한**: 40점 미만 강제 청산으로 큰 손실 방지 (평균 손실 -6.68%)
4. **높은 손익비**: 이익은 크게, 손실은 작게 → 7.51:1 달성

---

## 5. 관련 파일

| 파일 | 설명 |
|------|------|
| `technical_analyst.py` | `analyze_trend_following_strict()` 함수 |
| `backtest_latch_strategy.py` | 래치 전략 백테스트 스크립트 |
| `output/top100_strict_*.json` | 변별력 강화 TOP100 결과 |
| `output/backtest_strategy_*.json` | 점수 기반 전략 백테스트 결과 |
| `output/backtest_latch_*.json` | 래치 전략 백테스트 결과 |

---

## 6. 결론

### 핵심 요약
- **80점 이상은 진짜 주도주**: 기울기 + 거래량 + 신고가 3박자
- **래치 전략이 압도적 우위**: +82.99% vs +20.98% (4배 차이)
- **손익비가 핵심**: 61% 승률에 7.51:1 손익비 → 안정적 수익

### 권장 전략: 래치 전략

```
진입: AI 점수 80점 이상
청산: 점수 40점 미만 (극단적 모멘텀 붕괴)
      또는 20일선 이탈 (추세 종료)
```

> "점수로 들어가고, 추세가 끝날 때 나온다"

### 주의사항
- 점수 60점 매도는 휩소에 취약 → 권장하지 않음
- 40점 미만 청산이 20일선 이탈보다 먼저 발동하는 경우가 많음
- 대박 종목은 평균 2주 이상 보유 시 수익 극대화
