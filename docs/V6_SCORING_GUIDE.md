# V6 스코어링 엔진 - Swing Predictor (스윙 예측기)

## 🎯 핵심 철학

| 구분 | V4 (Hybrid Sniper) | V6 (Swing Predictor) |
|------|-------------------|---------------------|
| **목적** | "오늘 상태가 좋다" | **"2~5일 내 상승 확률 높다"** |
| **관점** | 현재 상태 측정 | **선행 지표** 위주 |
| **홀딩** | 당일 청산 | **2~5일 스윙** |
| **청산** | 종가 고정 매도 | **목표가/손절가 도달 시** |

---

## 📊 점수 체계 (100점 만점)

```
┌─────────────────────────────────────────────────────────────┐
│  V6 - Swing Predictor 점수 체계                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 에너지 축적 (35점) ─ 폭발 직전 신호                       │
│  ├─ 볼린저 밴드 극심한 수축 (<60%)     +12                   │
│  ├─ 볼린저 밴드 강한 수축 (<75%)       +8                    │
│  ├─ 볼린저 밴드 수축 (<90%)            +4                    │
│  ├─ ATR 수축 (<70%)                    +8                    │
│  ├─ ATR 감소 (<85%)                    +5                    │
│  ├─ VCP 패턴 감지                      +10                   │
│  ├─ VCP 타이트                         +2 (추가)             │
│  ├─ 거래량 수축 + 저점 상승            +5                    │
│  └─ 거래량 수축만                      +3                    │
│                                                             │
│  2. 세력 매집 (30점) ─ 스마트머니 추적                        │
│  ├─ OBV 강한 선행 상승 (가격-5%↓,OBV↑) +12                  │
│  ├─ OBV 선행 상승 (가격↓, OBV↑)        +8                    │
│  ├─ OBV 상승 중                        +4                    │
│  ├─ 매도 고갈 (저거래량 하락)          +8                    │
│  ├─ 저거래량 하락                      +5                    │
│  ├─ 기관+외국인 동시 순매수            +6                    │
│  ├─ 기관 또는 외국인 순매수            +3                    │
│  ├─ 연속 5일 이상 순매수               +4                    │
│  └─ 연속 3일 이상 순매수               +2                    │
│                                                             │
│  3. 기술적 지지 (20점) ─ 반등 확률                           │
│  ├─ 20일선 지지                        +5                    │
│  ├─ 60일선 지지                        +3                    │
│  ├─ 120일선 지지                       +2                    │
│  ├─ 피보나치 38.2%/50% 지지            +6                    │
│  ├─ 피보나치 61.8% 지지                +4                    │
│  ├─ 볼린저 하단 반등                   +4                    │
│  └─ 볼린저 하단 도달                   +2                    │
│                                                             │
│  4. 모멘텀 전환 (15점) ─ 방향 전환 신호                       │
│  ├─ MACD 히스토그램 양전환             +5                    │
│  ├─ MACD 히스토그램 상승               +3                    │
│  ├─ RSI 불리시 다이버전스              +5                    │
│  ├─ RSI 과매도 탈출                    +4                    │
│  ├─ RSI 과매도                         +2                    │
│  ├─ 스토캐스틱 바닥 골든크로스 (<30)   +5                    │
│  ├─ 스토캐스틱 골든크로스 (<50)        +3                    │
│  └─ 스토캐스틱 과매도 (<20)            +2                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🚫 과락 조건 (0점 처리)

| 조건 | 설명 |
|------|------|
| `STRONG_REVERSE_ALIGNMENT` | 20일선이 60일선보다 5% 이상 아래 (강한 역배열) |
| `RSI_EXTREME_OVERBOUGHT` | RSI 85 초과 (극단적 과매수) |
| `POSSIBLE_CLIMAX_TOP` | BB 상단 이탈 + 거래량 3배 (천장 신호) |
| `SHARP_DECLINE` | 당일 -5% 이상 급락 |

---

## ⚠️ 경고 신호

| 신호 | 설명 |
|------|------|
| `LOW_LIQUIDITY` | 거래대금 10억 미만 |
| `OVEREXTENDED_20D` | 20일간 +30% 이상 급등 |
| `RESISTANCE_NEARBY` | 상방 5% 이내 매물대 존재 |
| `CONSECUTIVE_DOWN_DAYS` | 최근 5일 중 4일 이상 음봉 |

---

## 🎯 투자 적격 기준

| 점수 | 등급 | 판정 | 홀딩 | 목표 | 손절 |
|------|------|------|------|------|------|
| **85+** | A | ✅ 강력 매수 | 5일 | ATR×2.5 | ATR×1.0 |
| **75-84** | B+ | ✅ 투자 적격 | 4일 | ATR×2.0 | ATR×1.0 |
| 65-74 | B | ⚠️ 관심 | 3일 | ATR×1.5 | ATR×1.0 |
| 65 미만 | C/D | ❌ 비추천 | 2일 | ATR×1.2 | ATR×0.8 |

**투자 적격 하한: 75점**

---

## 📈 청산 전략 (내장)

### 익절 (목표가 도달)
```
목표가 = 진입가 + (ATR × 목표배율)
- 85점 이상: ATR × 2.5
- 75점 이상: ATR × 2.0
- 65점 이상: ATR × 1.5
```

### 손절 (손절가 이탈)
```
손절가 = 진입가 - (ATR × 손절배율)
- 65점 이상: ATR × 1.0
- 65점 미만: ATR × 0.8
```

### 시간 손절 (최대 홀딩)
```
- 85점 이상: 5일
- 75점 이상: 4일
- 65점 이상: 3일
- 65점 미만: 2일
```

---

## 🔄 V4 vs V6 비교

| 항목 | V4 | V6 |
|------|----|----|
| VCP 패턴 | ✅ +12 | ✅ +10~12 |
| OBV 다이버전스 | ✅ +8 | ✅ +8~12 |
| 볼린저 수축 | ❌ | ✅ +4~12 |
| ATR 수축 | ❌ | ✅ +5~8 |
| 매도 고갈 | ❌ | ✅ +5~8 |
| 피보나치 지지 | ❌ | ✅ +4~6 |
| 이평선 지지 | ❌ | ✅ +2~5 |
| 기관/외국인 | ✅ +8 | ✅ +2~10 |
| RSI 다이버전스 | ❌ | ✅ +5 |
| 청산 전략 | ❌ 없음 | ✅ 내장 |

---

## 💻 사용법

### 기본 사용

```python
from score_v6_swing_predictor import calculate_score_v6

# OHLCV 데이터프레임 (최소 60일, 권장 120일)
result = calculate_score_v6(df)

if result:
    print(f"점수: {result['score']}")
    print(f"신호: {result['signals']}")
    print(f"청산전략: {result['exit_strategy']}")
```

### 기관/외국인 수급 데이터 포함

```python
investor_data = {
    'foreign_net': 50000,  # 외국인 5일 순매수량
    'institution_net': 30000,  # 기관 5일 순매수량
    'foreign_consecutive_days': 3,  # 외국인 연속 순매수 일수
    'institution_consecutive_days': 2,  # 기관 연속 순매수 일수
}

result = calculate_score_v6(df, investor_data)
```

### 거래 시뮬레이션

```python
from score_v6_swing_predictor import simulate_trade

# entry_idx: 신호 발생일 (iloc 인덱스)
trade_result = simulate_trade(df, entry_idx=100, exit_strategy=result['exit_strategy'])

print(f"진입가: {trade_result['entry_price']}")
print(f"청산가: {trade_result['exit_price']}")
print(f"수익률: {trade_result['pnl_pct']:.2f}%")
print(f"청산사유: {trade_result['exit_reason']}")
```

---

## 📊 백테스트 예상 개선점

### 기존 (V4, 당일 청산)
- 시가 매수 → 종가 매도
- 갭업 시 수익 공간 없음
- 점수와 수익 무상관

### 개선 (V6, 스윙)
- 시가 매수 → **목표가/손절가 청산**
- 손익비 1.5~2.5 확보
- **"폭발 직전" 종목**만 선별
- 시간 손절로 기회비용 관리

---

## 🚨 주의사항

1. **백테스트 필수**: 실전 적용 전 충분한 백테스트 수행
2. **슬리피지 고려**: 목표가/손절가 도달 시 실제 체결가 차이
3. **유동성 확인**: 거래대금 10억 미만 종목 주의
4. **분산 투자**: 한 종목에 과도한 비중 금지
