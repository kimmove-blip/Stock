# 주식 스크리닝 시스템 방법론

## 개요

본 시스템은 **기술적 분석(Technical Analysis)**을 기반으로 KRX 전종목(KOSPI + KOSDAQ)에서 매일 상위 100개 관심 종목을 자동 선별합니다.

---

## 1. 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    데이터 수집 레이어                              │
│  FinanceDataReader → KRX 전종목 OHLCV (시가/고가/저가/종가/거래량)   │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    1차 필터링: 유동성                              │
│  - 시가총액 ≥ 500억원                                            │
│  - 일 거래대금 ≥ 10억원                                          │
│  → 약 2,900개 → 900개로 축소                                     │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    2차 필터링: 특수종목 제외                        │
│  - 스팩, ETF, ETN, 리츠 제외                                     │
│  - 우선주 제외 (종목코드 끝자리 ≠ 0)                               │
│  - 관리종목, 정리매매 제외                                        │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    기술적 분석 엔진                                │
│  18개 기술적 지표 + 6개 캔들 패턴 분석                             │
│  → 종목별 종합 점수 산출 (0~100점)                                │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    결과 산출                                      │
│  - 점수 30점 이상 필터링                                          │
│  - 점수 내림차순 정렬                                             │
│  - 상위 100개 선정                                               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 기술적 지표 상세

### 2.1 추세 지표 (Trend Indicators)

#### 이동평균선 (Moving Averages)
| 지표 | 기간 | 용도 |
|------|------|------|
| SMA 5 | 5일 | 단기 추세 |
| SMA 20 | 20일 | 중기 추세 |
| SMA 60 | 60일 | 장기 추세 |
| EMA 12/26 | 12/26일 | MACD 계산용 |

**정배열 판단:**
```
SMA_5 > SMA_20 > SMA_60 → 상승 추세 (정배열)
SMA_5 < SMA_20 < SMA_60 → 하락 추세 (역배열)
```

**골든크로스/데드크로스:**
```
전일: SMA_5 < SMA_20, 금일: SMA_5 > SMA_20 → 골든크로스 (매수)
전일: SMA_5 > SMA_20, 금일: SMA_5 < SMA_20 → 데드크로스 (매도)
```

#### MACD (Moving Average Convergence Divergence)
```
MACD Line = EMA(12) - EMA(26)
Signal Line = EMA(MACD, 9)
Histogram = MACD - Signal
```

| 신호 | 조건 | 의미 |
|------|------|------|
| 골든크로스 | MACD가 Signal 상향 돌파 | 상승 모멘텀 시작 |
| 히스토그램 양전환 | Histogram: 음 → 양 | 추세 전환 |

#### ADX (Average Directional Index)
```
ADX = 추세의 강도 (방향 무관)
+DI = 상승 방향 강도
-DI = 하락 방향 강도
```

| ADX 값 | 해석 |
|--------|------|
| 0~20 | 추세 없음 (횡보) |
| 20~25 | 추세 형성 중 |
| 25~50 | 강한 추세 |
| 50+ | 매우 강한 추세 |

**매수 조건:** ADX > 25 AND +DI > -DI → 강한 상승 추세

#### Supertrend
```
기본 밴드 = (고가 + 저가) / 2
Upper Band = 기본 밴드 + (ATR × multiplier)
Lower Band = 기본 밴드 - (ATR × multiplier)
```
- 가격이 Upper Band 위 → 하락 추세
- 가격이 Lower Band 아래 → 상승 추세
- **매수 신호:** 하락→상승 전환 시점

#### Parabolic SAR (PSAR)
- 가격 아래 점 → 상승 추세
- 가격 위 점 → 하락 추세
- **매수 신호:** 점이 가격 위→아래로 전환

#### Ichimoku Cloud (일목균형표)
```
전환선 = (9일 고가 + 9일 저가) / 2
기준선 = (26일 고가 + 26일 저가) / 2
선행스팬A = (전환선 + 기준선) / 2 (26일 선행)
선행스팬B = (52일 고가 + 52일 저가) / 2 (26일 선행)
```

| 신호 | 조건 | 의미 |
|------|------|------|
| 골든크로스 | 전환선 > 기준선 상향 돌파 | 단기 상승 |
| 구름대 위 | 종가 > 선행스팬A, B | 상승 추세 확인 |

---

### 2.2 모멘텀 지표 (Momentum Indicators)

#### RSI (Relative Strength Index)
```
RS = 평균 상승폭 / 평균 하락폭 (14일)
RSI = 100 - (100 / (1 + RS))
```

| RSI 구간 | 해석 | 점수 |
|----------|------|------|
| 0~30 | 과매도 (반등 기대) | +15점 |
| 30~50 | 회복 구간 | +5점 |
| 50~70 | 정상 구간 | 0점 |
| 70~100 | 과매수 (조정 주의) | -10점 |

#### Stochastic Oscillator
```
%K = (현재가 - 14일 최저가) / (14일 최고가 - 14일 최저가) × 100
%D = %K의 3일 이동평균
```

| 신호 | 조건 | 점수 |
|------|------|------|
| 과매도 골든크로스 | %K < 30에서 %K > %D 돌파 | +20점 |
| 일반 골든크로스 | %K > %D 돌파 | +10점 |
| 과매도 | %K < 20 | +5점 |

#### CCI (Commodity Channel Index)
```
TP = (고가 + 저가 + 종가) / 3
CCI = (TP - SMA(TP, 20)) / (0.015 × 평균편차)
```

| CCI 값 | 해석 | 점수 |
|--------|------|------|
| < -100 | 과매도 | +10점 |
| > +100 | 과매수 | -5점 |

#### Williams %R
```
%R = (최고가 - 현재가) / (최고가 - 최저가) × -100
```

| %R 값 | 해석 | 점수 |
|-------|------|------|
| < -80 | 과매도 | +10점 |
| > -20 | 과매수 | -5점 |

#### ROC (Rate of Change)
```
ROC = (현재가 - n일전 종가) / n일전 종가 × 100
```

| 신호 | 조건 | 점수 |
|------|------|------|
| 양전환 | ROC: 음 → 양 | +10점 |
| 강한 모멘텀 | ROC > 5% | +5점 |

---

### 2.3 거래량 지표 (Volume Indicators)

#### 거래량 배율
```
거래량 배율 = 금일 거래량 / 20일 평균 거래량
```

| 배율 | 해석 | 점수 |
|------|------|------|
| ≥ 2.0 | 급증 (세력 매집 의심) | +15점 |
| ≥ 1.5 | 증가 | +10점 |
| ≥ 1.2 | 평균 이상 | +5점 |

**근거:** 주가 상승 시 거래량 동반 증가는 추세의 신뢰도를 높임

#### OBV (On Balance Volume)
```
종가 상승 → OBV += 거래량
종가 하락 → OBV -= 거래량
종가 동일 → OBV 유지
```

| 신호 | 조건 | 점수 |
|------|------|------|
| OBV 이평선 위 | OBV > OBV의 20일 이평 | +10점 |
| OBV 상승 추세 | 5일전 대비 5% 상승 | +5점 |

**근거:** OBV 상승 = 매수세 우위 = 가격 상승 선행 지표

#### MFI (Money Flow Index)
```
Typical Price = (고가 + 저가 + 종가) / 3
Money Flow = TP × 거래량
MFI = 100 - (100 / (1 + Money Ratio))
```

| MFI 구간 | 해석 | 점수 |
|----------|------|------|
| < 20 | 과매도 (강한 매수 신호) | +15점 |
| < 40 | 저구간 (매수 기회) | +5점 |
| > 80 | 과매수 (차익실현 압력) | -10점 |

**근거:** RSI + 거래량 결합 → RSI보다 신뢰도 높음

#### CMF (Chaikin Money Flow)
```
CMF = Σ(ADL × 거래량) / Σ거래량 (20일)
ADL = ((종가 - 저가) - (고가 - 종가)) / (고가 - 저가)
```

| CMF 값 | 해석 | 점수 |
|--------|------|------|
| > 0.2 | 강한 자금 유입 (기관 매수) | +10점 |
| > 0 | 자금 유입 | +5점 |
| < -0.2 | 강한 자금 유출 | -10점 |

**근거:** 기관/세력의 매집/분산 패턴 감지

---

### 2.4 변동성 지표 (Volatility Indicators)

#### Bollinger Bands (볼린저 밴드)
```
중심선 = SMA(20)
상단 밴드 = 중심선 + (2 × 표준편차)
하단 밴드 = 중심선 - (2 × 표준편차)
```

| 신호 | 조건 | 점수 |
|------|------|------|
| 하단 반등 | 전일 하단 터치 → 금일 반등 | +15점 |
| 하단 터치 | 종가 < 하단 밴드 | +10점 |
| 상단 돌파 | 종가 > 상단 밴드 | -5점 |

**근거:** 볼린저 밴드 하단 = 2표준편차 이탈 = 통계적 저점

#### ATR (Average True Range)
```
TR = max(고가-저가, |고가-전일종가|, |저가-전일종가|)
ATR = SMA(TR, 14)
```

- 손절/목표가 설정 기준으로 활용
- ATR% = ATR / 종가 × 100 → 변동성 비율

---

### 2.5 캔들 패턴 (Candlestick Patterns)

| 패턴 | 의미 | 점수 |
|------|------|------|
| Hammer (망치형) | 하락 후 반전 신호 | +10점 |
| Inverted Hammer (역망치형) | 바닥권 반전 가능 | +8점 |
| Bullish Engulfing (상승 장악형) | 강한 반전 신호 | +15점 |
| Bearish Engulfing (하락 장악형) | 하락 전환 | -10점 |
| Morning Star (샛별형) | 강력한 바닥 반전 | +20점 |
| Evening Star (저녁별형) | 강력한 고점 반전 | -15점 |
| Doji (도지) | 변곡점 (추가 확인 필요) | 0점 |

---

## 3. 점수 산정 체계

### 3.1 점수 범위
- **최소:** 0점
- **최대:** 100점
- **기준선:** 30점 (이상만 선정)

### 3.2 점수 산정 공식

```
총점 = Σ(발생한 신호의 점수)
최종점수 = max(0, min(100, 총점))
```

### 3.3 신호별 점수 배분

#### 강력 매수 신호 (High Impact)
| 신호 | 점수 | 근거 |
|------|------|------|
| 골든크로스 (20/60) | +25 | 중장기 추세 전환, 가장 신뢰도 높음 |
| MACD 골든크로스 | +20 | 모멘텀 전환의 대표 신호 |
| 슈퍼트렌드 매수 | +20 | ATR 기반 추세 전환 |
| 스토캐스틱 과매도 골든크로스 | +20 | 저점에서 반등 확인 |
| 샛별형 (Morning Star) | +20 | 3일 패턴, 강력한 반전 |
| 골든크로스 (5/20) | +20 | 단기 추세 전환 |

#### 보조 매수 신호 (Medium Impact)
| 신호 | 점수 | 근거 |
|------|------|------|
| 이평선 정배열 | +15 | 추세 방향 확인 |
| RSI 과매도 | +15 | 통계적 저점 |
| MFI 과매도 | +15 | 자금 흐름 저점 |
| 볼린저 하단 반등 | +15 | 변동성 하단 반등 |
| 거래량 급증 (2배+) | +15 | 세력 관심 |
| PSAR 매수 | +15 | 추세 전환 |
| ADX 강한 상승 | +15 | 추세 강도 확인 |
| 일목 골든크로스 | +15 | 일목균형표 매수 신호 |
| 상승 장악형 | +15 | 캔들 반전 패턴 |

#### 약한 매수 신호 (Low Impact)
| 신호 | 점수 | 근거 |
|------|------|------|
| MACD 히스토그램 양전환 | +10 | 모멘텀 개선 |
| 스토캐스틱 골든크로스 | +10 | 단기 반등 |
| OBV 이평선 위 | +10 | 수급 개선 |
| ROC 양전환 | +10 | 모멘텀 시작 |
| 구름대 위 | +10 | 지지선 확보 |
| CMF 강한 유입 | +10 | 기관 매수 |
| CCI 과매도 | +10 | 저점 신호 |
| Williams %R 과매도 | +10 | 저점 신호 |
| 거래량 증가 (1.5배+) | +10 | 관심 증가 |
| 볼린저 하단 터치 | +10 | 저점 접근 |
| ADX 상승 추세 | +10 | 추세 형성 |
| Hammer (망치형) | +10 | 반전 가능 |

#### 보정 점수
| 신호 | 점수 |
|------|------|
| RSI 회복 중 (30~50) | +5 |
| MFI 저구간 | +5 |
| OBV 상승 추세 | +5 |
| ROC 강한 모멘텀 | +5 |
| CMF 양수 | +5 |
| 거래량 평균 이상 | +5 |
| MACD 히스토그램 상승 | +5 |
| 슈퍼트렌드 상승 | +5 |
| Inverted Hammer | +8 |

#### 감점 신호 (Risk Factors)
| 신호 | 점수 | 근거 |
|------|------|------|
| 데드크로스 (5/20) | -15 | 하락 전환 |
| 저녁별형 (Evening Star) | -15 | 강력한 하락 신호 |
| RSI 과매수 | -10 | 단기 고점 |
| MFI 과매수 | -10 | 차익실현 압력 |
| 하락 장악형 | -10 | 하락 전환 |
| CMF 강한 유출 | -10 | 기관 매도 |
| 볼린저 상단 돌파 | -5 | 단기 과열 |
| CCI 과매수 | -5 | 고점 신호 |
| Williams %R 과매수 | -5 | 고점 신호 |

---

## 4. 이론적 근거

### 4.1 기술적 분석의 기본 가정

1. **시장은 모든 것을 반영한다**
   - 가격에는 모든 정보(펀더멘털, 심리, 외부요인)가 이미 반영됨
   - 따라서 가격 움직임만 분석하면 충분

2. **가격은 추세를 따른다**
   - 일단 형성된 추세는 지속되는 경향
   - 추세 전환 신호가 나타날 때까지 추세 추종이 유리

3. **역사는 반복된다**
   - 과거 패턴은 미래에도 유사하게 나타남
   - 투자자 심리가 반복적이기 때문

### 4.2 다중 지표 사용 이유

1. **신호 확인 (Confirmation)**
   - 단일 지표는 거짓 신호(False Signal) 가능성
   - 여러 지표가 동시에 같은 방향 → 신뢰도 상승

2. **다양한 관점**
   - 추세 지표: "방향은?"
   - 모멘텀 지표: "속도는?"
   - 거래량 지표: "힘은?"
   - 변동성 지표: "범위는?"

3. **상호 보완**
   - RSI: 과매수/과매도 (역추세)
   - ADX: 추세 강도 (추세 추종)
   - 두 지표 결합 → 거짓 신호 필터링

### 4.3 거래량의 중요성

```
"거래량은 가격에 선행한다" - 기술적 분석의 격언
```

- **상승 + 거래량 증가** → 건강한 상승 (추가 상승 기대)
- **상승 + 거래량 감소** → 약한 상승 (반전 주의)
- **하락 + 거래량 증가** → 공포 매도 (바닥 가능)
- **하락 + 거래량 감소** → 관심 감소 (추가 하락)

### 4.4 골든크로스의 통계적 유효성

학술 연구에 따르면:
- 골든크로스 후 60일 평균 수익률: +3~5%
- 승률: 약 55~60%
- **20/60 골든크로스**가 5/20보다 신뢰도 높음 (노이즈 적음)

---

## 5. 한계점 및 주의사항

### 5.1 기술적 분석의 한계

1. **후행성**
   - 대부분 지표가 과거 데이터 기반
   - 추세 전환 초기 감지 어려움

2. **자기실현적 예언**
   - 많은 투자자가 같은 지표 사용 시 신호 유효성 감소
   - 과적합(Overfitting) 위험

3. **펀더멘털 무시**
   - 기업 실적, 재무 상태 미반영
   - 나쁜 회사도 기술적 신호 발생 가능

### 5.2 본 시스템의 한계

1. **당일 종가 기준**
   - 장마감 후 분석 → 다음날 시초가 다를 수 있음
   - 갭상승/갭하락 시 진입 가격 불리

2. **거래비용 미반영**
   - 수수료, 슬리피지 미고려
   - 단기 매매 시 비용 영향 클 수 있음

3. **시장 상황 미반영**
   - 전체 시장 하락 시 개별 신호 무력화
   - 대외 변수(금리, 환율, 지정학) 미반영

### 5.3 권장 사용법

1. **참고 자료로 활용**
   - 최종 판단은 투자자 본인
   - 추가 분석(뉴스, 재무, 산업) 필요

2. **분할 매수**
   - 한 번에 전액 투자 지양
   - 2~3회 분할 진입 권장

3. **손절 기준 설정**
   - 슈퍼트렌드/PSAR 하향 전환 시 손절
   - 진입가 대비 -5~7% 손절

4. **과열 종목 주의**
   - 점수 100점이라도 과매수 신호 다수 → 조정 가능
   - RSI > 70, MFI > 80 동시 발생 시 눌림목 대기

---

## 6. 파일 구조

```
/home/kimhc/Stock/
├── technical_analyst.py   # 기술적 분석 엔진 (18개 지표)
├── market_screener.py     # 전종목 스크리닝 시스템
├── daily_top100.py        # 일일 실행 스크립트
├── config.py              # 설정 파일 (필터 기준, 점수 가중치)
├── output/                # 결과 파일 저장
│   ├── top100_YYYYMMDD.xlsx
│   ├── top100_YYYYMMDD.json
│   ├── top100_YYYYMMDD.csv
│   ├── top100_YYYYMMDD.md
│   └── top100_YYYYMMDD.pdf
└── docs/
    └── METHODOLOGY.md     # 본 문서
```

---

## 7. 참고 문헌

1. Murphy, J. J. (1999). *Technical Analysis of the Financial Markets*
2. Pring, M. J. (2002). *Technical Analysis Explained*
3. Wilder, J. W. (1978). *New Concepts in Technical Trading Systems* (RSI, ATR, ADX 창시자)
4. Bollinger, J. (2001). *Bollinger on Bollinger Bands*
5. Ichimoku, G. (1969). *일목균형표 연구*

---

*문서 버전: 1.0*
*최종 수정: 2026-01-11*
